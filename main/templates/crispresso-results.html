{% extends 'base.html' %}

{% load static %}
{% load humanize %}

{% block content %}

<p>
  {% if analysis.is_custom %}
  Analysis of uploaded sample sheet.
  {# TODO: show more of custom analysis? #}
  {% else %}
  Analysis of experiment {{ analysis.experiment.name }}.
  {% endif %}
  FastQ files from
  <a target="_blank" href="{{ analysis.s3_url }}">
    {{ analysis.s3_address }}.
  </a>
</p>

<h2 class="d-inline-block">
  Crispresso Reports
</h2>
<a class="d-inline-block align-top" target="_blank" href="http://crispresso.pinellolab.partners.org/help">
  [?]
</a>

<table class="table">
  <thead class="thead-light">
    <tr>
      {% if not analysis.is_custom %}
      <th>Well Position</th>
      {% endif %}
      {# TODO: show original target here? <th>Target</th> #}
      <th>Zip</th>
      <th>Report</th>
      {% for stat_name in sheet.to_records.0.report_stats %}
      <th title="{{ stat_name }}">{{ stat_name|truncatechars:32 }}</th>
      {% endfor %}
    </tr>
  </thead>
  {% for row in sheet.to_records %}
  <tr>
    {% if not analysis.is_custom %}
    <td>{{ row.index }}</td>
    {% endif %}
    {# <td>{{ row.target_loc }}</td> #}
    <td><a target="_blank" href="{{ row.report_zip }}" class="btn btn-primary btn-sm">
      download
    </a></td>
    <td><a target="_blank" href="{{ row.report_url }}" class="btn btn-outline-primary btn-sm">
      open
    </a></td>
    {% for stat in row.report_stats.values %}
    <td class="text-right">{{ stat|intcomma }}</td>
    {% endfor %}
  </tr>
  {% endfor %}
</table>

<h4>
  <a href="#inputsTable" data-toggle="collapse" class="btn btn-outline-secondary btn-sm">Crispresso Inputs</a>
</h4>
<div id="inputsTable" class="small collapse">
  <table class="table">
    <thead class="thead-light">
      <tr>
        <th>fastq_r1</th>
        <th>fastq_r2</th>
        <th>amplicon</th>
        <th>sgRNA</th>
        <th>hdr_seq</th>
      </tr>
    </thead>
    {% for input, files in input_data %}
    <tr>
      <td>{{ files.0 }}</td>
      <td>{{ files.1 }}</td>
      <td title={{ input.amplicon }}>{{ input.amplicon|truncatechars:64 }}</td>
      <td>{{ input.sgRNA }}</td>
      <td>{{ input.hdr_seq|truncatechars:32 }}</td>
    </tr>
    {% endfor %}
  </table>
</div>

{% endblock content %}
